{% from 'user_macros.html' import intention %}
{% extends "layout.html" %}
{% block css %}
    {% assets "user_css" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}">
        <script src="https://use.fontawesome.com/a911e2def4.js"></script>
    {% endassets %}

    <style>
        /*.datepicker {
            display: none;
        }*/
        .picker__date-display {
            background-color: white;
            color: #d24141 !important;
        }

        .picker__footer {
            display: none !important;
        }

        .picker__holder {
            position: static !important;
            border: 0 !important;
        }

        .picker__month-display {
            font-size: 1rem;
        }

        .picker__day-display {
            font-size: 2em;
        }

        .picker__year-display {
            font-size: 2em;
            color: #d24141 !important;
        }

        .datepicker {
            display: none !important;
        }

        .picker {
            font-size: 14px !important;
        }

        .picker__box {
            border: none;
            box-shadow: none;
            margin-top: 20px !important;
        }

        .picker__table {
            font-size: 0.8rem;
        }
        .picker__header {
            /*margin-left: 38px !important;*/
        }

        .picker__weekday-display {
            display: none !important;
        }

        .picker__day--selected {
            background-color: #d24141 !important;
        }
    </style>
{% endblock %}
{% block content %}
        <h2 class="en-tete" style="background-color: #d24141"><img src="{{url_for('static', filename='img/ampoule-idee.png')}}">J'agis</h2>        
        <div class="row">
            <div class="col s12">
                <ul class="tabs">
                    <li class="tab col s4"><a class="active" href="#actions">Passer à l'action</a></li>
                    <li class="tab col s4"><a href="#test2">Recherche une action</a></li>
                    <li class="tab col s4"><a href="#create">Créer une action</a></li>
                </ul>
                </div>
                <div id="actions" class="col s12">
                    <div class="row">
                        <div class="col s3">
                            <input class="datepicker"/>    
                        </div>
                        <div class="col s9">
                            <div id="actions">
                            </div>
                        </div>
                    </div>
                    {% for row in actions| batch(4) %}
                        <div class="row">
                        {% for action in row %}
                            <div class="col s3">
                             <div class="card">
                                <div class="card-content white-text">
                                    <span class="card-title">{{action.title}}</span>
                                    <p>{{action.description}}</p>
                                </div>
                                <div class="card-action">
                                    <a href="#">
                                        {% if action.has_been_realised_today() %}
                                            Réalisé !
                                        {% else %}
                                            Non réalisé
                                        {% endif %}
                                    </a>
                                </div>
                            </div>
                            </div>
                        {% endfor %}
                        </div>
                    {% else %}
                        <p>Participer à ou créer une nouvelle action !</p>
                    {% endfor %}
                    </div>
                </div>
                <div id="test2" class="col s12">Test 2</div>
                <div id="create" class="col s12" style="padding: 0 25%">
                    <h6>Je définis mon action</h6>
                    <div class="row">
                        
                        
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                          <input id="title" type="text">
                          <label class="active" for="first_name2">Son intitulé</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                          <textarea id="description" class="materialize-textarea" rows="10"></textarea>
                          <label class="active" for="description">Sa description</label>
                        </div>
                    </div>
                </div>
        </div>
{% endblock %}

{% block js %}
    <script src="{{url_for('static', filename='libs/moment/min/moment.min.js')}}"></script>
    <script>
    $(document).ready(function() {
    // page is now ready, initialize the calendar...
       var $input = $('.datepicker').pickadate({
            klass: {
                picker: "picker picker--opened",
                opened: "__always-open__"
            }
            });
       /*var picker = $input.pickadate('picker');

       var elem = picker.$root;*/
    });
    </script>
    <script src="{{url_for('static', filename='js/require.js')}}"></script>
    <script src="{{url_for('static', filename='libs/hyperscript/index.js')}}"></script>

    <script>
        var state = {};

        function setState(object) {
            state = Object.assign({}, state, object);
        }

        function cardNode(action) {
            var buttonText = "Réalisé";
            return ( 
                div(".card", {}, [
                    div(".card-content.white-text", {}, [
                        span(".card-title", {}, action.title),
                        p("", {}, action.description)
                        ]
                    ),
                    div(".card-action", {}, [
                        a("",  {href: "#"}, buttonText)
                        ]
                    )
                ])
            );             
        }

        function partitionList(list, bucketSize) {
           var output = [];

            for (var i = 0; i < input.length; i += spacing) {
                output[output.length] = input.slice(i, i + spacing);
            }
            return output;
        }

        function actionsList(actions) {
            return partitionList(actions).map(subactions => {
                return div(".row", {}, subactions.map((action, i) => { 
                    return div('.col.s' + i + 1,  {}, cardNode(action))
                }))
            });
        }

        function refreshActions(actions) {
            var node = document.getElementById('actions');
            var fc = node.firstChild;
            while( fc ) {
                node.removeChild( fc );
                fc = node.firstChild;
            }
            node.appendChild(actionsList);
        }

        $.getJSON('/user/actions/get', function(data) {
            state.updateState({actions: data});
            refreshActions(state.actions);
        });

    </script>

{% endblock %}